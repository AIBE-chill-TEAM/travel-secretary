<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>여행 경로</title>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjJeFd04uDAsqYthhLNFEfZd4UzJDb9Tw"
      async
      defer
    ></script>
    <script>
      let map;
      let markers = [];
      let polyline;

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 37.7749, lng: -122.4194 },
          zoom: 13,
        });
      }

      function openInsetMap() {
        const insetMapWindow = window.open(
          "insertMap.html",
          "_blank",
          "width=800,height=600"
        );

        // 저장된 마커와 경로를 전달하는 로직을 추가합니다 (예: localStorage 또는 window 객체 사용)
        insetMapWindow.addEventListener("load", () => {
          insetMapWindow.postMessage({ markers: markers }, "*");
        });
      }

      window.addEventListener("message", (event) => {
        if (event.data.markers) {
          markers = event.data.markers;
          drawRoute();
        }
      });

      function drawRoute() {
        const path = markers.map((marker) => marker.getPosition());
        if (polyline) {
          polyline.setMap(null);
        }
        polyline = new google.maps.Polyline({
          path: path,
          geodesic: true,
          strokeColor: "#FF0000",
          strokeOpacity: 1.0,
          strokeWeight: 2,
        });
        polyline.setMap(map);
        markers.forEach((marker) => marker.setMap(map));
      }
    </script>
  </head>
  <body onload="initMap()">
    <h2>여행 경로</h2>
    <div id="map" style="width: 100%; height: 500px"></div>
    <button onclick="openInsetMap()">여행경로 입력하기</button>
  </body>
</html>
